/*
 A JavaScript implementation of the SHA family of hashes, as
 defined in FIPS PUB 180-4 and FIPS PUB 202, as well as the corresponding
 HMAC implementation as defined in FIPS PUB 198a

 Copyright Brian Turek 2008-2017
 Distributed under the BSD License
 See http://caligatio.github.com/jsSHA/ for more information

 Several functions taken from Paul Johnston
*/
'use strict';(function(L){function u(d,b,h){var c=0,a=[],l=0,e,m,k,f,n,g,q,v,A=!1,p=[],u=[],w,z=!1,x=!1,t=-1;h=h||{};e=h.encoding||"UTF8";w=h.numRounds||1;if(w!==parseInt(w,10)||1>w)throw Error("numRounds must a integer >= 1");if(0===d.lastIndexOf("SHA3-",0)||0===d.lastIndexOf("SHAKE",0)){var C=6;g=B;v=function(c){var a=[],e;for(e=0;5>e;e+=1)a[e]=c[e].slice();return a};t=1;if("SHA3-224"===d)n=1152,f=224;else if("SHA3-256"===d)n=1088,f=256;else if("SHA3-384"===d)n=832,f=384;else if("SHA3-512"===d)n=
576,f=512;else if("SHAKE128"===d)n=1344,f=-1,C=31,x=!0;else if("SHAKE256"===d)n=1088,f=-1,C=31,x=!0;else throw Error("Chosen SHA variant is not supported");q=function(c,a,e,f,d){e=n;var b=C,m,l=[],g=e>>>5,k=0,h=a>>>5;for(m=0;m<h&&a>=e;m+=g)f=B(c.slice(m,m+g),f),a-=e;c=c.slice(m);for(a%=e;c.length<g;)c.push(0);m=a>>>3;c[m>>2]^=b<<m%4*8;c[g-1]^=2147483648;for(f=B(c,f);32*l.length<d;){c=f[k%5][k/5|0];l.push(c.b);if(32*l.length>=d)break;l.push(c.a);k+=1;0===64*k%e&&B(null,f)}return l}}else throw Error("Chosen SHA variant is not supported");
k=D(b,e,t);m=y(d);this.setHMACKey=function(a,b,l){var k;if(!0===A)throw Error("HMAC key already set");if(!0===z)throw Error("Cannot set HMAC key after calling update");if(!0===x)throw Error("SHAKE is not supported for HMAC");e=(l||{}).encoding||"UTF8";b=D(b,e,t)(a);a=b.binLen;b=b.value;k=n>>>3;l=k/4-1;if(k<a/8){for(b=q(b,a,0,y(d),f);b.length<=l;)b.push(0);b[l]&=4294967040}else if(k>a/8){for(;b.length<=l;)b.push(0);b[l]&=4294967040}for(a=0;a<=l;a+=1)p[a]=b[a]^909522486,u[a]=b[a]^1549556828;m=g(p,m);
c=n;A=!0};this.update=function(e){var b,f,d,h=0,q=n>>>5;b=k(e,a,l);e=b.binLen;f=b.value;b=e>>>5;for(d=0;d<b;d+=q)h+n<=e&&(m=g(f.slice(d,d+q),m),h+=n);c+=h;a=f.slice(h>>>5);l=e%n;z=!0};this.getHash=function(e,b){var k,g,h,n;if(!0===A)throw Error("Cannot call getHash after setting HMAC key");h=E(b);if(!0===x){if(-1===h.shakeLen)throw Error("shakeLen must be specified in options");f=h.shakeLen}switch(e){case "HEX":k=function(a){return F(a,f,t,h)};break;case "B64":k=function(a){return G(a,f,t,h)};break;
case "BYTES":k=function(a){return H(a,f,t)};break;case "ARRAYBUFFER":try{g=new ArrayBuffer(0)}catch(r){throw Error("ARRAYBUFFER not supported by this environment");}k=function(a){return I(a,f,t)};break;default:throw Error("format must be HEX, B64, BYTES, or ARRAYBUFFER");}n=q(a.slice(),l,c,v(m),f);for(g=1;g<w;g+=1)!0===x&&0!==f%32&&(n[n.length-1]&=16777215>>>24-f%32),n=q(n,f,0,y(d),f);return k(n)};this.getHMAC=function(e,b){var k,h,p,w;if(!1===A)throw Error("Cannot call getHMAC without first setting HMAC key");
p=E(b);switch(e){case "HEX":k=function(a){return F(a,f,t,p)};break;case "B64":k=function(a){return G(a,f,t,p)};break;case "BYTES":k=function(a){return H(a,f,t)};break;case "ARRAYBUFFER":try{k=new ArrayBuffer(0)}catch(M){throw Error("ARRAYBUFFER not supported by this environment");}k=function(a){return I(a,f,t)};break;default:throw Error("outputFormat must be HEX, B64, BYTES, or ARRAYBUFFER");}h=q(a.slice(),l,c,v(m),f);w=g(u,y(d));w=q(h,f,n,w,f);return k(w)}}function g(d,b){this.a=d;this.b=b}function F(d,
b,h,c){var a="";b/=8;var l,e,m;m=-1===h?3:0;for(l=0;l<b;l+=1)e=d[l>>>2]>>>8*(m+l%4*h),a+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(e&15);return c.outputUpper?a.toUpperCase():a}function G(d,b,h,c){var a="",l=b/8,e,m,k,f;f=-1===h?3:0;for(e=0;e<l;e+=3)for(m=e+1<l?d[e+1>>>2]:0,k=e+2<l?d[e+2>>>2]:0,k=(d[e>>>2]>>>8*(f+e%4*h)&255)<<16|(m>>>8*(f+(e+1)%4*h)&255)<<8|k>>>8*(f+(e+2)%4*h)&255,m=0;4>m;m+=1)8*e+6*m<=b?a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>
6*(3-m)&63):a+=c.b64Pad;return a}function H(d,b,h){var c="";b/=8;var a,l,e;e=-1===h?3:0;for(a=0;a<b;a+=1)l=d[a>>>2]>>>8*(e+a%4*h)&255,c+=String.fromCharCode(l);return c}function I(d,b,h){b/=8;var c,a=new ArrayBuffer(b),l,e;e=new Uint8Array(a);l=-1===h?3:0;for(c=0;c<b;c+=1)e[c]=d[c>>>2]>>>8*(l+c%4*h)&255;return a}function E(d){var b={outputUpper:!1,b64Pad:"=",shakeLen:-1};d=d||{};b.outputUpper=d.outputUpper||!1;!0===d.hasOwnProperty("b64Pad")&&(b.b64Pad=d.b64Pad);if(!0===d.hasOwnProperty("shakeLen")){if(0!==
d.shakeLen%8)throw Error("shakeLen must be a multiple of 8");b.shakeLen=d.shakeLen}if("boolean"!==typeof b.outputUpper)throw Error("Invalid outputUpper formatting option");if("string"!==typeof b.b64Pad)throw Error("Invalid b64Pad formatting option");return b}function D(d,b,h){switch(b){case "UTF8":case "UTF16BE":case "UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE");}switch(d){case "HEX":d=function(c,a,b){var e=c.length,d,k,f,g,r,q;if(0!==e%2)throw Error("String of HEX type must be in byte increments");
a=a||[0];b=b||0;r=b>>>3;q=-1===h?3:0;for(d=0;d<e;d+=2){k=parseInt(c.substr(d,2),16);if(isNaN(k))throw Error("String of HEX type contains invalid characters");g=(d>>>1)+r;for(f=g>>>2;a.length<=f;)a.push(0);a[f]|=k<<8*(q+g%4*h)}return{value:a,binLen:4*e+b}};break;case "TEXT":d=function(c,a,d){var e,m,k=0,f,g,r,q,v,p;a=a||[0];d=d||0;r=d>>>3;if("UTF8"===b)for(p=-1===h?3:0,f=0;f<c.length;f+=1)for(e=c.charCodeAt(f),m=[],128>e?m.push(e):2048>e?(m.push(192|e>>>6),m.push(128|e&63)):55296>e||57344<=e?m.push(224|
e>>>12,128|e>>>6&63,128|e&63):(f+=1,e=65536+((e&1023)<<10|c.charCodeAt(f)&1023),m.push(240|e>>>18,128|e>>>12&63,128|e>>>6&63,128|e&63)),g=0;g<m.length;g+=1){v=k+r;for(q=v>>>2;a.length<=q;)a.push(0);a[q]|=m[g]<<8*(p+v%4*h);k+=1}else if("UTF16BE"===b||"UTF16LE"===b)for(p=-1===h?2:0,f=0;f<c.length;f+=1){e=c.charCodeAt(f);"UTF16LE"===b&&(g=e&255,e=g<<8|e>>>8);v=k+r;for(q=v>>>2;a.length<=q;)a.push(0);a[q]|=e<<8*(p+v%4*h);k+=2}return{value:a,binLen:8*k+d}};break;case "B64":d=function(c,a,b){var e=0,d,g,
f,n,r,q,p,u;if(-1===c.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");g=c.indexOf("=");c=c.replace(/\=/g,"");if(-1!==g&&g<c.length)throw Error("Invalid '=' found in base-64 string");a=a||[0];b=b||0;q=b>>>3;u=-1===h?3:0;for(g=0;g<c.length;g+=4){r=c.substr(g,4);for(f=n=0;f<r.length;f+=1)d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(r[f]),n|=d<<18-6*f;for(f=0;f<r.length-1;f+=1){p=e+q;for(d=p>>>2;a.length<=d;)a.push(0);a[d]|=(n>>>16-8*f&255)<<
8*(u+p%4*h);e+=1}}return{value:a,binLen:8*e+b}};break;case "BYTES":d=function(c,a,b){var e,d,g,f,n,p;a=a||[0];b=b||0;g=b>>>3;p=-1===h?3:0;for(d=0;d<c.length;d+=1)e=c.charCodeAt(d),n=d+g,f=n>>>2,a.length<=f&&a.push(0),a[f]|=e<<8*(p+n%4*h);return{value:a,binLen:8*c.length+b}};break;case "ARRAYBUFFER":try{d=new ArrayBuffer(0)}catch(c){throw Error("ARRAYBUFFER not supported by this environment");}d=function(c,a,b){var d,g,k,f,n,p;a=a||[0];b=b||0;g=b>>>3;n=-1===h?3:0;p=new Uint8Array(c);for(d=0;d<c.byteLength;d+=
1)f=d+g,k=f>>>2,a.length<=k&&a.push(0),a[k]|=p[d]<<8*(n+f%4*h);return{value:a,binLen:8*c.byteLength+b}};break;default:throw Error("format must be HEX, TEXT, B64, BYTES, or ARRAYBUFFER");}return d}function z(d,b){return 32<b?(b-=32,new g(d.b<<b|d.a>>>32-b,d.a<<b|d.b>>>32-b)):0!==b?new g(d.a<<b|d.b>>>32-b,d.b<<b|d.a>>>32-b):d}function p(d,b){return new g(d.a^b.a,d.b^b.b)}function y(d){var b=[];if(0===d.lastIndexOf("SHA3-",0)||0===d.lastIndexOf("SHAKE",0))for(d=0;5>d;d+=1)b[d]=[new g(0,0),new g(0,0),
new g(0,0),new g(0,0),new g(0,0)];else throw Error("No SHA variants supported");return b}function B(d,b){var h,c,a,l,e=[],m=[];if(null!==d)for(c=0;c<d.length;c+=2)b[(c>>>1)%5][(c>>>1)/5|0]=p(b[(c>>>1)%5][(c>>>1)/5|0],new g(d[c+1],d[c]));for(h=0;24>h;h+=1){l=y("SHA3-");for(c=0;5>c;c+=1){a=b[c][0];var k=b[c][1],f=b[c][2],n=b[c][3],r=b[c][4];e[c]=new g(a.a^k.a^f.a^n.a^r.a,a.b^k.b^f.b^n.b^r.b)}for(c=0;5>c;c+=1)m[c]=p(e[(c+4)%5],z(e[(c+1)%5],1));for(c=0;5>c;c+=1)for(a=0;5>a;a+=1)b[c][a]=p(b[c][a],m[c]);
for(c=0;5>c;c+=1)for(a=0;5>a;a+=1)l[a][(2*c+3*a)%5]=z(b[c][a],J[c][a]);for(c=0;5>c;c+=1)for(a=0;5>a;a+=1)b[c][a]=p(l[c][a],new g(~l[(c+1)%5][a].a&l[(c+2)%5][a].a,~l[(c+1)%5][a].b&l[(c+2)%5][a].b));b[0][0]=p(b[0][0],K[h])}return b}var J,K;K=[new g(0,1),new g(0,32898),new g(2147483648,32906),new g(2147483648,2147516416),new g(0,32907),new g(0,2147483649),new g(2147483648,2147516545),new g(2147483648,32777),new g(0,138),new g(0,136),new g(0,2147516425),new g(0,2147483658),new g(0,2147516555),new g(2147483648,
139),new g(2147483648,32905),new g(2147483648,32771),new g(2147483648,32770),new g(2147483648,128),new g(0,32778),new g(2147483648,2147483658),new g(2147483648,2147516545),new g(2147483648,32896),new g(0,2147483649),new g(2147483648,2147516424)];J=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]];"function"===typeof define&&define.amd?define(function(){return u}):"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(module.exports=u),exports=u):
L.jsSHA=u})(this);
